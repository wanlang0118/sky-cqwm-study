<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sky.mapper.OrderDetailMapper">

    <!-- 批量插入订单明细 -->
    <insert id="insertBatch">

            insert into order_detail (name, image, order_id, dish_id, setmeal_id, dish_flavor, number, amount)
            values
            <foreach collection="details" item="item" separator=",">
                (#{item.name}, #{item.image}, #{item.orderId}, #{item.dishId}, #{item.setmealId}, #{item.dishFlavor}, #{item.number}, #{item.amount})
            </foreach>

    </insert>

    <!-- 根据订单id查询明细 -->
    <select id="listByOrderId" resultType="com.sky.entity.OrderDetail">
        select *
        from order_detail
        where order_id = #{orderId}
        order by id asc
    </select>

    <!-- 销量Top10（按商品名聚合，包含菜品与套餐），仅统计已完成订单 -->
    <select id="top10Sales" resultType="java.util.Map">
        select
            name,
            sum(number) as total
        from order_detail
        where order_id in (
            select id from orders
            where status = 5
              and order_time &gt;= #{begin}
              and order_time &lt; #{end}
        )
        group by name
        order by total desc
        limit 10
    </select>

</mapper>
